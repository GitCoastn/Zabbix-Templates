zabbix_export:
  version: '7.4'
  template_groups:
    - uuid: c8eab832bd684e91b4968e737cc77b6c
      name: Templates/Printers
  templates:
    - uuid: 442ee0bf75624e45b312f2dcb2d0979c
      template: 'Canon MF Printers by SNMP'
      name: 'Canon MF Printers by SNMP'
      description: |
        SNMP monitoring template for Canon MF752Cdw with toner, tray and IP discovery, triggers and graphs.
        
        Template made by Carsten Brenner (https://github.com/GitCoastn/Zabbix-Templates). Feel free to change and tweak it for your preferences.
      groups:
        - name: Templates/Printers
      items:
        - uuid: 5cb67faafed2406eb15fd1c48605a585
          name: 'ICMP ping'
          type: SIMPLE
          key: icmpping
          tags:
            - tag: component
              value: health
            - tag: component
              value: network
          triggers:
            - uuid: 2b8511cebc9341f4815f2c4b4b0c2779
              expression: 'max(/Canon MF Printers by SNMP/icmpping,#3)=0 and {$NORMALSTATE}=1'
              name: 'ICMP Ping: Unavailable by ICMP ping'
              priority: HIGH
              description: |
                Last three attempts returned timeout.  Please check device connectivity.
                If the printer is normally shut down when not used, change the NORMALSTATE-Macro to 0
              tags:
                - tag: scope
                  value: availability
        - uuid: 291eea4f184d461e8dc4d06d4550b963
          name: 'Total failed jobs'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.43.10.2.1.5.1.1
          key: printer.counter.failedjobs
          delay: 5m
          history: 1h
          trends: '0'
          units: Jobs
          description: 'Number of failed jobs'
        - uuid: 901d1298664e48e9a64322e32ddbcf02
          name: 'Total printed pages'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.43.10.2.1.4.1.1
          key: printer.counter.pages
          delay: 5m
          history: 1h
          trends: '0'
          units: pages
          description: 'Printer operational status (ready / Processing/Data / Error).'
          triggers:
            - uuid: 42cef26c69164db89f273d4edf3d8ea6
              expression: 'change(/Canon MF Printers by SNMP/printer.counter.pages)>0'
              name: 'Canon: Page(s) was/were printed'
              opdata: 'Counter: {ITEM.LASTVALUE1}'
              priority: INFO
        - uuid: abbb3bc70b1045a3bc93c82e6d635c66
          name: 'Cover status'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.43.6.1.1.3.1.1
          key: printer.cover.status
          delay: 30s
          history: 1h
          trends: '0'
          description: 'Printer cover state (1 usually means normal/closed; others indicate an issue).'
          valuemap:
            name: coverStatus
        - uuid: 0a9580d3ba2a46b384345578bc300f57
          name: Description
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.1.0
          key: printer.description
          delay: 10m
          history: 1h
          value_type: TEXT
          description: 'Printer uptime'
        - uuid: 5c4170b30aa64ed78734df108e72dea4
          name: Hostname
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.5.0
          key: printer.hostname
          delay: 10m
          history: 1h
          value_type: TEXT
          description: 'Printer hostname'
        - uuid: 652e5fcf52f14b66b69b723a9e49c6fd
          name: 'Job status'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.43.17.6.1.5.1.1
          key: printer.job.status
          delay: 30s
          history: 1h
          value_type: CHAR
          description: 'Printer job status.'
        - uuid: 6709692ef6c84aa993d495ac6537f803
          name: Location
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.6.0
          key: printer.location
          delay: 10m
          history: 1h
          value_type: TEXT
          description: 'Printer location'
        - uuid: 91c7849c044c48aaba0e51c73faed3ff
          name: 'Printer status'
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.43.16.5.1.2.1.1
          key: printer.status
          delay: 30s
          history: 1h
          value_type: CHAR
          description: 'Printer operational status (ready / Processing/Data / Error).'
        - uuid: feadcfb8ad704fa4921fc4734433b9b1
          name: Uptime
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.3.0
          key: printer.uptime
          history: 1h
          trends: '0'
          units: uptime
          description: 'Printer uptime'
      discovery_rules:
        - uuid: c0c835c9fc2f40e69f5cb7fcb5612090
          name: 'Toner discovery'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#SNMPVALUE}, 1.3.6.1.2.1.43.11.1.1.6.1, {#COLOR}, 1.3.6.1.2.1.43.12.1.1.4.1]'
          key: printer.toner.discovery
          delay: 6h
          description: 'Discovers all toners in the system'
          item_prototypes:
            - uuid: 069824a07f7c4ea6a5f0ed499f8b255d
              name: 'Toner {#COLOR} level'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.43.11.1.1.9.1.{#SNMPINDEX}'
              key: 'printer.toner.level[{#COLOR}]'
              delay: 5m
              history: 14d
              trends: '0'
              units: '%'
              description: 'Toner current level for {#SNMPVALUE}.'
              trigger_prototypes:
                - uuid: 30957c58694546718b3487c2af3f408a
                  expression: 'last(/Canon MF Printers by SNMP/printer.toner.level[{#COLOR}])<5'
                  name: 'Canon: Toner color {#COLOR} level'
                  opdata: 'Current: {ITEM.LASTVALUE1}'
                  priority: HIGH
                  tags:
                    - tag: scope
                      value: availability
                - uuid: 5c0abea8694446ea98fe31d592379f54
                  expression: 'last(/Canon MF Printers by SNMP/printer.toner.level[{#COLOR}])<20'
                  name: 'Canon: Toner color {#COLOR} level'
                  opdata: 'Current: {ITEM.LASTVALUE1}'
                  priority: WARNING
                  dependencies:
                    - name: 'Canon: Toner color {#COLOR} level'
                      expression: 'last(/Canon MF Printers by SNMP/printer.toner.level[{#COLOR}])<5'
                  tags:
                    - tag: scope
                      value: availability
            - uuid: 9b8de915d2254da2ac4623d871c60eb3
              name: 'Toner {#COLOR} maximum'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.43.11.1.1.8.1.{#SNMPINDEX}'
              key: 'printer.toner.max[{#COLOR}]'
              delay: 5m
              history: 14d
              trends: '0'
              status: DISABLED
              discover: NO_DISCOVER
              description: 'Toner maximum level for {#SNMPVALUE}.'
            - uuid: 38482998615c40c89e79da412e071192
              name: 'Toner {#COLOR} rest'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.43.11.1.1.7.1.{#SNMPINDEX}'
              key: 'printer.toner.rest[{#COLOR}]'
              delay: 5m
              history: 14d
              trends: '0'
              status: DISABLED
              discover: NO_DISCOVER
              description: 'Toner current rest for {#SNMPVALUE}.'
        - uuid: 7c28d04bb13e4805936d3b99f9ee1d49
          name: 'Tray discovery'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#SNMPVALUE}, 1.3.6.1.2.1.43.8.2.1.13.1]'
          key: printer.tray.discovery
          delay: 6h
          filter:
            conditions:
              - macro: '{#SNMPVALUE}'
                value: 'Multi-purpose Tray'
                operator: NOT_MATCHES_REGEX
          description: |
            Discovers all connected paper trays.
            The "Multi-purpose Tray" however is filtered out.
          item_prototypes:
            - uuid: 7cc29ad22850498fbf7d7c39034954bc
              name: 'Tray {#SNMPVALUE} level'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.2.1.43.8.2.1.10.1.{#SNMPINDEX}'
              key: 'printer.tray.level.[{#SNMPVALUE}]'
              history: 1d
              value_type: FLOAT
              trends: '0'
              description: 'Current paper level in tray {#SNMPVALUE}.'
              valuemap:
                name: trayLevel
              trigger_prototypes:
                - uuid: 15ad6f85d3f3401b8fb3c10fd668c013
                  expression: 'last(/Canon MF Printers by SNMP/printer.tray.level.[{#SNMPVALUE}])<0 and last(/Canon MF Printers by SNMP/printer.tray.level.[{#SNMPVALUE}])>-3'
                  name: 'Canon: Issues receiving tray level of "{#SNMPVALUE}"'
                  opdata: 'Current: {ITEM.LASTVALUE1}'
                  priority: WARNING
                  description: 'You may consider to disable the item for this tray.'
                  dependencies:
                    - name: 'Canon: Tray "{#SNMPVALUE}" seems to be empty'
                      expression: 'last(/Canon MF Printers by SNMP/printer.tray.level.[{#SNMPVALUE}])=0'
                - uuid: 0672744721d64542a8909a34b45d6ccb
                  expression: 'last(/Canon MF Printers by SNMP/printer.tray.level.[{#SNMPVALUE}])=0'
                  name: 'Canon: Tray "{#SNMPVALUE}" seems to be empty'
                  priority: HIGH
                - uuid: 033e291d9ba24833bd333a107236b1bd
                  expression: 'last(/Canon MF Printers by SNMP/printer.tray.level.[{#SNMPVALUE}])<10 and last(/Canon MF Printers by SNMP/printer.tray.level.[{#SNMPVALUE}])>0'
                  name: 'Canon: Tray level of "{#SNMPVALUE}" is low'
                  opdata: 'Current: {ITEM.LASTVALUE1}'
                  priority: WARNING
                  dependencies:
                    - name: 'Canon: Tray "{#SNMPVALUE}" seems to be empty'
                      expression: 'last(/Canon MF Printers by SNMP/printer.tray.level.[{#SNMPVALUE}])=0'
      macros:
        - macro: '{$NORMALSTATE}'
          value: '1'
          description: 'Default state of the printer (0=normally off, 1=permanently on)'
      valuemaps:
        - uuid: acf70695fc884f10a01a1d04b773dd9d
          name: coverStatus
          mappings:
            - value: '1'
              newvalue: other
            - value: '3'
              newvalue: doorOpen
            - value: '4'
              newvalue: doorClosed
            - value: '5'
              newvalue: interlockOpen
            - value: '6'
              newvalue: interlockClosed
        - uuid: 7b7a1526dc7a4446a51429c993db1c9a
          name: trayLevel
          mappings:
            - value: '-1'
              newvalue: other
            - value: '-2'
              newvalue: unknown
            - value: '-3'
              newvalue: atLeastOne
  triggers:
    - uuid: 065acd377ef04b9585898f0b9d83303c
      expression: 'min(/Canon MF Printers by SNMP/icmpping,#3)=1 and length(last(/Canon MF Printers by SNMP/printer.status))>0 and {$NORMALSTATE}=0'
      name: 'ICMP Ping: Printer is online right now'
      opdata: 'State: {ITEM.LASTVALUE2}'
      priority: INFO
      description: |
        Your printer is currently running. This is just informal, as normally its powered off.
        If the printer is normally always on, change the NORMALSTATE-Macro to 1
      tags:
        - tag: scope
          value: availability
